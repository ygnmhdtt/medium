---
title: "NATインスタンスについて学んだ"
date: 2017-11-18T18:39:17+09:00
tags:
- AWS
- NAT
---
NATインスタンス(EC2)は Source/Destチェック を無効にしなければいけない理由について学んだ。

<!--more-->

AWSインフラでNATインスタンスを構築する際は、NATインスタンス自身の Source/Destチェック を無効にする必要がある。

# NATインスタンスとは？

プライベートサブネットからインターネットに出るために使う。
プライベートサブネットのルートテーブルで、デフォルトルートをNATインスタンスに向ける。
NATインスタンス自体はパブリックサブネット自体にある。

# Source/Destチェック とは？

インスタンスが自分宛てに来たパケット以外を捨てるための設定。

# 何故無効にするのか？

NATインスタンスは、その性質上自分宛てのパケットをインターネットに通す必要がある。
プライベートサブネットはインターネットへのトラフィックをNATインスタンスに送信し、
NATインスタンスの(正確にはNATインスタンスがあるパブリックサブネットの)ルートテーブルのデフォルトルートはインターネットゲートウェイに向いているため。
しかし、インスタンスはデフォルトで自分宛てでないパケットは捨てる(いらないから)ので、そこはパススルーするような設定が必要。

# いちいち設定するのが面倒なのでは？

NATゲートウェイを使うのが良い。
NATインスタンスは設定が面倒だし、インスタンス使用量かかるし、スケールしない(HTTP Proxyを使えばスケールできる)ので、あんまり使いたくない。
