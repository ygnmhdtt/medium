---
title: "Kubernetesについて学ぶ 9"
date: 2018-03-19T22:31:54+09:00
tags:
- kubernetes
---

これでラスト。

<!--more-->

# Running Multiple Instances of Your App

```

以前のモジュールでは、デプロイメントを作成し、サービスを通じて公開しました。
デプロイメントは、アプリケーションを実行するために1つのポッドのみを作成しました。
トラフィックが増加すると、ユーザーの需要に対応するためにアプリケーションを拡張する必要があります。
```

```
デプロイメントをスケールアウトすると、新しいポッドが作成され、
使用可能なリソースを持つノードにスケジュールされます。
拡大縮小すると、ポッドの数が新しい希望の状態に減少します。
Kubernetesはまた、Podのオートスケーリングをサポートしますが、このチュートリアルの範囲外です。
ゼロへのスケーリングも可能で、指定されたDeploymentのすべてのポッドを終了します。

アプリケーションの複数のインスタンスを実行するには、
すべてのインスタンスにトラフィックを分散する方法が必要です。
サービスには、公開された展開のすべてのポッドにネットワークトラフィックを分散する統合ロードバランサがあります。
サービスは、エンドポイントを使用して実行中のポッドを継続的に監視し、トラフィックが使用可能なポッドにのみ送信されるようにします。

スケーリングは、Deployment内のレプリカの数を変更することによって実行されます。
```

Pod単位でスケールアウトし、ロードバランシングもしてくれるらしい。
ヘルスチェックもサポートしてくれる。
ホストマシン(仮想マシンも)自体を冗長化したときはどうするのかな。マスターがいい感じに見てくれるのだろうか。

# Performing a Rolling Update

```
ユーザーはいつでもアプリケーションを利用できると期待しており、
開発者は新しいバージョンを1日に数回展開することが予想されます。
Kubernetesでは、これはローリングアップデートで行われます。
更新をローリングすると、Podsインスタンスを新しいインスタンスで段階的に更新することにより、
ダウンタイムゼロでデプロイメントのアップデートを実行できます。
新しいポッドは、利用可能なリソースを持つノードでスケジュールされます。

前のモジュールでは、複数のインスタンスを実行するようにアプリケーションを拡張しました。
これは、アプリケーションの可用性に影響を与えずに更新を実行するための要件です。
デフォルトでは、更新中に使用できないポッドの最大数と、作成できる新しいポッドの最大数は1です。
両方のオプションは、（ポッドの）数値またはパーセンテージのいずれかに設定できます。
Kubernetesでは、更新プログラムがバージョン管理され、展開更新プログラムは以前の（安定版）バージョンに戻すことができます。
```

ローリングアップデートで大丈夫なのかな、、、

```
アプリケーションのスケーリングと同様に、デプロイメントが公開されている場合、
サービスは更新中に利用可能なポッドにのみトラフィックをロードバランシングします。
使用可能なポッドは、アプリケーションのユーザーが使用できるインスタンスです。

ローリングアップデートでは、次の操作が可能です。

* ある環境から別の環境にアプリケーションをプロモートする（コンテナイメージの更新を介して）
* 以前のバージョンにロールバックする
* 停止時間ゼロのアプリケーションの継続的な統合と継続的な配信

デプロイメントが公開されている場合、サービスは更新中に利用可能なポッドにのみトラフィックをロードバランシングします。
```

kubernetesマジ頭いい。

# 所感

一通り終わった。
こんなの人間に使いこなせるのか？と思わなくもない。
