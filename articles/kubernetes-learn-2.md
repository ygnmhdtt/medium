---
title: "Kubernetesについて学ぶ 2"
date: 2018-01-12T18:51:28+09:00
tags:
- kubernetes
---

引き続き学んでいく。

<!--more-->

1は[こちら](https://yaginumahidetatsu.com/2018/01/12/kubernetes-learn-1/)。

今回は[Create a Cluster](https://kubernetes.io/docs/tutorials/kubernetes-basics/cluster-intro/)を読んでいく。

### Using Minikube to Create a Cluster

```
Kubernetesは、単一ユニットとして動作するように接続されている可用性の高いコンピュータクラスタを調整します。 
Kubernetesの抽象化によって、コンテナ化されたアプリケーションを個々のマシンに具体的に結びつけることなく
クラスタに展開することができます。この新しいデプロイメントモデルを利用するには、
アプリケーションを個々のホストから切り離す方法でパッケージ化する必要があります。つまり:
それらをコンテナ化する必要があります。

コンテナ化されたアプリケーションは、アプリケーションがホストに深く統合されたパッケージとして
特定のマシンに直接インストールされていた過去のデプロイメントモデルよりも柔軟性があり、利用可能です。 
Kubernetesは、クラスタ全体のアプリケーションコンテナの配布とスケジューリングをより効率的に自動化します。 
Kubernetesはオープンソースのプラットフォームで、プロダクションの準備が整いました。

Kubernetesクラスタは、2種類のリソースで構成されています。

* The Master: クラスタを調整する
* Nodes: アプリケーションを実行するワーカー
```

従来は、アプリケーションとホストが深く結合されており、柔軟性を欠いていた。(ホストに障害が起きたりしたらアプリも死ぬ。逆に、スケールも難しい。)
しかし、アプリケーションをコンテナ化することで、個々のマシンと疎結合な状態を生み出すことができる。
`クラスタ` というものがそのabstractionsを実現してくれているらしい。
しかし、コンテナという物自体はLXCやdockerが提供してくれていたが、
kubernetesが *クラスタ全体のアプリケーションコンテナの配布とスケジューリングをより効率的に自動化* してくれるらしい。
つまり、ホストとアプリを疎結合にすることはkubernetesの仕事ではなく、(それはコンテナで実現される)
クラスタにアプリを配備し、スケジューリングすることが仕事だと言える(たぶん)。

### Cluster Diagram

```
マスターはクラスタの管理を担当します。
マスターは、アプリケーションのスケジューリング、アプリケーションの望ましい状態の維持、
アプリケーションのスケーリング、新しい更新の展開など、クラスター内のすべてのアクティビティーを調整します。

ノードは、Kubernetesクラスタ内のワーカーマシンとして機能するVMまたは物理コンピュータです。
各ノードには、ノードを管理し、Kubernetesマスターと通信するためのエージェントであるKubeletがあります。
ノードには、Dockerやrktなどのコンテナ操作を処理するツールも必要です。
運用トラフィックを処理するKubernetesクラスタには、最低3つのノードが必要です。

Kubernetesにアプリケーションをデプロイするときは、
マスターにアプリケーションコンテナを開始するよう指示します。
マスターは、クラスタのノード上で実行するコンテナのスケジュールを設定します。
ノードは、マスターが公開するKubernetes APIを使用してマスターと通信します。
エンドユーザーは、Kubernetes APIを直接使用してクラスタとやりとりすることもできます。

Kubernetesクラスタは、物理マシンまたは仮想マシンのいずれにも展開できます。 
Kubernetes開発を開始するには、Minikubeを使用できます。 
Minikubeは、ローカルマシンにVMを作成し、1つのノードだけを含む単純なクラスタを展開する軽量Kubernetesの実装です。 
Minikubeは、Linux、macOS、およびWindowsシステムで使用できます。 
Minikube CLIは、クラスタを操作するための基本的なブートストラップ操作（開始、停止、ステータス、および削除を含む）を提供します。
ただし、このチュートリアルでは、Minikubeがプリインストールされているオンライン端末を使用します。

Kubernetesが何であるかを知ったので、オンラインチュートリアルに進み、最初のクラスターを開始しましょう！
```

* マスターはクラスタ全体の管理をしている(実体はホスト)
* ノードはサーバーのこと。
* 各ノードには、Kubeletというエージェントがいる
* クラスタには最低3ノード必要

つまり。
masterにはクラスタ全体の情報を管理させ、ノードがマスターに対して、API経由で情報をもらい、
自ノードの上でコンテナを作る。
APIはデベロッパがたたくこともできるらしい。

ここで `Minikube` というものが出てくる。
Minikubeを使って、ローカルにVMを起動し、1つのノードを持つクラスタを動かせるらしい。

### 所感

マスター、ノードなど、普通のサーバのクラスタリングっぽい感じらしい。
その上で、各ノードにはKubeletというエージェントがいて、masterとのやりとりをしてくれるとのこと。
つまり、ここまではまだそんなに難しくなくて、API経由でなにをするのか？Kubeletはどんな仕事をするのか？が大事となる。

ちなみに、Elasticsearchもこんな感じの構造になってますよね。

次回はチュートリアルをやってみる。
